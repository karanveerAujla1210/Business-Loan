<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniBusiness Loan - Monitoring Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #333; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h3 { color: #666; font-size: 14px; margin-bottom: 10px; text-transform: uppercase; }
        .card .value { font-size: 32px; font-weight: bold; color: #333; }
        .card .label { font-size: 12px; color: #999; margin-top: 5px; }
        .status { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .status.good { background: #d4edda; color: #155724; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.error { background: #f8d7da; color: #721c24; }
        .alerts { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .alert-item { padding: 12px; border-left: 4px solid #dc3545; background: #f8f9fa; margin-bottom: 10px; border-radius: 4px; }
        .alert-item .time { font-size: 12px; color: #666; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #0056b3; }
        .refresh-info { color: #666; font-size: 14px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Monitoring Dashboard</h1>
        
        <div class="grid">
            <div class="card">
                <h3>Total Requests</h3>
                <div class="value" id="totalRequests">-</div>
                <div class="label">Since last reset</div>
            </div>
            <div class="card">
                <h3>Error Rate</h3>
                <div class="value" id="errorRate">-</div>
                <div class="label" id="totalErrors">0 errors</div>
            </div>
            <div class="card">
                <h3>Avg Response Time</h3>
                <div class="value" id="avgResponseTime">-</div>
                <div class="label" id="slowRequests">0 slow requests</div>
            </div>
            <div class="card">
                <h3>Uptime</h3>
                <div class="value" id="uptime">-</div>
                <div class="label">Server uptime</div>
            </div>
            <div class="card">
                <h3>Memory Usage</h3>
                <div class="value" id="memoryUsage">-</div>
                <div class="label" id="memoryDetails">-</div>
            </div>
            <div class="card">
                <h3>Status</h3>
                <div class="value"><span class="status good" id="status">Healthy</span></div>
                <div class="label">System status</div>
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <button onclick="refreshMetrics()">üîÑ Refresh</button>
            <button onclick="resetMetrics()">üóëÔ∏è Reset Metrics</button>
            <button onclick="window.location.href='/api/v1/health'">‚ù§Ô∏è Health Check</button>
        </div>

        <div class="alerts">
            <h3 style="margin-bottom: 15px;">Recent Alerts</h3>
            <div id="alertsList">No alerts</div>
        </div>

        <div class="refresh-info">Auto-refresh every 10 seconds</div>
    </div>

    <script>
        async function fetchMetrics() {
            try {
                const response = await fetch('/api/v1/metrics');
                const data = await response.json();
                
                if (data.status) {
                    const metrics = data.data;
                    document.getElementById('totalRequests').textContent = metrics.totalRequests.toLocaleString();
                    document.getElementById('errorRate').textContent = metrics.errorRate;
                    document.getElementById('totalErrors').textContent = `${metrics.totalErrors} errors`;
                    document.getElementById('avgResponseTime').textContent = metrics.avgResponseTime;
                    document.getElementById('slowRequests').textContent = `${metrics.slowRequests} slow requests`;
                    
                    const uptimeHours = Math.floor(metrics.uptime / 3600);
                    const uptimeMinutes = Math.floor((metrics.uptime % 3600) / 60);
                    document.getElementById('uptime').textContent = `${uptimeHours}h ${uptimeMinutes}m`;
                    
                    const memUsage = ((metrics.memory.heapUsed / metrics.memory.heapTotal) * 100).toFixed(1);
                    document.getElementById('memoryUsage').textContent = `${memUsage}%`;
                    document.getElementById('memoryDetails').textContent = 
                        `${(metrics.memory.heapUsed / 1024 / 1024).toFixed(0)}MB / ${(metrics.memory.heapTotal / 1024 / 1024).toFixed(0)}MB`;
                    
                    const errorRate = parseFloat(metrics.errorRate);
                    const statusEl = document.getElementById('status');
                    if (errorRate > 5 || memUsage > 80) {
                        statusEl.textContent = 'Warning';
                        statusEl.className = 'status warning';
                    } else if (errorRate > 10) {
                        statusEl.textContent = 'Critical';
                        statusEl.className = 'status error';
                    } else {
                        statusEl.textContent = 'Healthy';
                        statusEl.className = 'status good';
                    }
                }
            } catch (error) {
                console.error('Failed to fetch metrics:', error);
            }
        }

        async function refreshMetrics() {
            await fetchMetrics();
        }

        async function resetMetrics() {
            if (confirm('Are you sure you want to reset all metrics?')) {
                try {
                    await fetch('/api/v1/metrics/reset', { method: 'POST' });
                    await fetchMetrics();
                } catch (error) {
                    console.error('Failed to reset metrics:', error);
                }
            }
        }

        fetchMetrics();
        setInterval(fetchMetrics, 10000);
    </script>
</body>
</html>
